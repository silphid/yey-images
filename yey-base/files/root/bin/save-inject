#!/bin/bash
set -e

# The YEY_INJECT variable is required for this command
if [[ -z ${YEY_INJECT+x} || ! -d $YEY_INJECT ]]; then
  echo "error: the YEY_INJECT env var must refer to mounted directory used to store injection files"
  exit
fi

if [[ $# -ne 1 ]]; then
  echo
  echo "Syntax:"
  echo
  echo "  save-inject PATH"
  echo
  exit
fi

SOURCE_PATH=$(realpath ${1//\~/$HOME})
SOURCE_DIR=$(dirname $SOURCE_PATH)
TARGET_DIR="$YEY_INJECT$SOURCE_DIR"

if [[ ! -d $TARGET_DIR ]]; then
  mkdir -p $TARGET_DIR
fi

cp -auv $SOURCE_PATH $TARGET_DIR
